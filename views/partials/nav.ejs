<nav class="navbar">
  <!-- Background glow orbs -->
  <div class="orb orb-1" aria-hidden="true"></div>
  <div class="orb orb-2" aria-hidden="true"></div>

  <div class="navbar-inner">
    <a href="/" class="navbar-logo">
      <img src="/img/brand/logo.svg" alt="" width="42" height="42" class="logo-icon" />
      ThinkNote
    </a>

    <div class="navbar-links" id="navLinks">
      <a href="/explore" class="nav-link">
        <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
        <span>Exhibition</span>
      </a>
      <a href="/search" class="nav-link">
        <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 6h16M4 12h16M4 18h10"/></svg>
        <span>Search</span>
      </a>
      <% if (currentUser) { %>
        <a href="/feed" class="nav-link">
          <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
          <span>Workshop</span>
        </a>
      <% } %>
    </div>

    <div class="navbar-actions">
      <% if (currentUser) { %>
        <a href="/new-post" class="btn btn-primary btn-sm">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M12 5v14M5 12h14"/></svg>
          Construct
        </a>

        <div class="avatar-wrap" id="avatarMenu">
          <button class="avatar-btn" id="avatarBtn" aria-label="Account menu">
            <img src="<%= currentUser.avatarUrl %>" alt="<%= currentUser.displayName %>" />
          </button>
          <div class="dropdown-menu" id="dropdownMenu">
            <div class="dropdown-header">
              <strong><%= currentUser.displayName %></strong>
              <span>@<%= currentUser.username %></span>
            </div>
            <a href="/u/<%= currentUser.username %>" class="dropdown-item">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
              Profile
            </a>
            <a href="/bookmarks" class="dropdown-item">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m19 21-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"/></svg>
              Archived Blueprints
            </a>
            <a href="/settings" class="dropdown-item">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M12 2v3m0 14v3m8.66-13-2.6 1.5m-12.12 7-2.6 1.5m15.39 0-2.6-1.5M4.34 7.5 1.74 9m18.52 0-2.6-1.5"/></svg>
              Settings
            </a>
            <% if (currentUser.role === 'admin') { %>
              <div class="dropdown-divider"></div>
              <a href="/admin" class="dropdown-item">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>
                Admin
              </a>
            <% } %>
            <div class="dropdown-divider"></div>
            <a href="/auth/logout" class="dropdown-item danger">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16,17 21,12 16,7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
              Sign Out
            </a>
          </div>
        </div>
      <% } else { %>
        <a href="/auth/login" class="btn btn-ghost btn-sm">Sign In</a>
        <a href="/auth/register" class="btn btn-primary btn-sm">Get Started â†’</a>
      <% } %>
    </div>
  </div>
</nav>
<script>
  // Dropdown toggle
  const avatarBtn = document.getElementById('avatarBtn');
  const dropdownMenu = document.getElementById('dropdownMenu');
  if (avatarBtn && dropdownMenu) {
    avatarBtn.addEventListener('click', e => {
      e.stopPropagation();
      dropdownMenu.classList.toggle('open');
    });
    document.addEventListener('click', () => dropdownMenu.classList.remove('open'));
  }
</script>
