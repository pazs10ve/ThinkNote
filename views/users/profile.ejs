<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title><%= title %></title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Lora:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="/css/main.css" />
</head>
<body>
<%- include('../partials/nav') %>
<main class="main-content">
  <div class="container" style="max-width:860px">

    <!-- Profile header -->
    <div class="card" style="display:flex;gap:2rem;align-items:flex-start;flex-wrap:wrap;margin-bottom:2rem">
      <img src="<%= profileUser.avatarUrl || '/img/default-avatar.png' %>"
           alt="<%= profileUser.displayName %>"
           style="width:96px;height:96px;border-radius:50%;object-fit:cover;border:3px solid var(--border);flex-shrink:0" />
      <div style="flex:1">
        <h1 style="font-size:1.5rem;margin-bottom:0.15rem"><%= profileUser.displayName %></h1>
        <p style="color:var(--text-muted);margin-bottom:0.75rem">@<%= profileUser.username %></p>
        <% if (profileUser.bio) { %><p style="margin-bottom:0.75rem"><%= profileUser.bio %></p><% } %>
        <div style="display:flex;gap:1.5rem;font-size:0.88rem;color:var(--text-muted);margin-bottom:1rem;flex-wrap:wrap">
          <a href="/u/<%= profileUser.username %>/followers" style="color:var(--text-muted)">
            <strong style="color:var(--text)"><%= profileUser.followers.length %></strong> Followers
          </a>
          <a href="/u/<%= profileUser.username %>/following" style="color:var(--text-muted)">
            <strong style="color:var(--text)"><%= profileUser.following.length %></strong> Following
          </a>
          <span><strong style="color:var(--text)"><%= posts.length %></strong> Posts</span>
        </div>
        <div style="display:flex;gap:0.75rem;flex-wrap:wrap">
          <% if (currentUser && currentUser._id.toString() !== profileUser._id.toString()) { %>
            <button class="btn <%= isFollowing ? 'btn-outline' : 'btn-primary' %> btn-sm" id="followBtn" data-username="<%= profileUser.username %>">
              <%= isFollowing ? 'Following' : 'Follow' %>
            </button>
          <% } %>
          <% if (currentUser && currentUser._id.toString() === profileUser._id.toString()) { %>
            <a href="/settings" class="btn btn-outline btn-sm">Edit Profile</a>
          <% } %>
          <% if (profileUser.website) { %><a href="<%= profileUser.website %>" target="_blank" rel="noopener" class="btn btn-ghost btn-sm">üåê Website</a><% } %>
          <% if (profileUser.twitter) { %><a href="https://twitter.com/<%= profileUser.twitter %>" target="_blank" rel="noopener" class="btn btn-ghost btn-sm">Twitter</a><% } %>
          <% if (profileUser.github) { %><a href="https://github.com/<%= profileUser.github %>" target="_blank" rel="noopener" class="btn btn-ghost btn-sm">GitHub</a><% } %>
        </div>
      </div>
    </div>

    <!-- Posts -->
    <h2 style="font-size:1.1rem;margin-bottom:1.25rem">Posts</h2>
    <% if (posts.length === 0) { %>
      <div class="empty-state"><p>No published posts yet.</p></div>
    <% } else { %>
      <div class="post-list">
        <% posts.forEach(post => { %><%- include('../partials/post-card', { post }) %><% }) %>
      </div>
    <% } %>
  </div>
</main>
<footer class="site-footer"><div class="container"><p>¬© 2026 <strong>ThinkNote</strong></p></div></footer>
<script src="/js/main.js"></script>
<script src="/js/follow.js"></script>
</body>
</html>

