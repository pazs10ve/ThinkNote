<!DOCTYPE html>
<html lang="en">
<head>
  <%- include('../partials/head') %>
</head>
<body>
  <%- include('../partials/nav') %>

  <main class="main-content">
    <div class="container">

      <!-- Hero -->
      <div class="feed-hero">
        <h1><%= feedType === 'following' ? 'Your Drafting Desk' : 'The Global Workshop' %></h1>
        <p class="lead" style="max-width:520px">
          <%= feedType === 'following'
            ? 'The builders and thinkers you\'ve chosen to follow.'
            : 'Study the blueprints of the world\'s most inventive minds.' %>
        </p>
      </div>

      <div class="feed-layout">
        <!-- Posts column -->
        <div>
          <!-- Filter tabs -->
          <div class="filter-bar">
            <a href="/" class="filter-tab <%= feedType === 'global' ? 'active' : '' %>">Public Blueprints</a>
            <% if (currentUser) { %>
              <a href="/feed" class="filter-tab <%= feedType === 'following' ? 'active' : '' %>">Following</a>
            <% } %>
            <% if (activeTag) { %>
              <span class="filter-tab active" style="gap:0.4rem">
                #<%= activeTag %>
                <a href="/" style="color:inherit;margin-left:2px;opacity:0.6;font-size:0.8rem">✕</a>
              </span>
            <% } %>
          </div>

          <% if (posts.length === 0) { %>
            <div class="empty-state">
              <div style="font-size:2.5rem;margin-bottom:1rem">
                <img src="/img/brand/logo.svg" alt="" width="64" height="64" style="opacity:0.25" />
              </div>
              <% if (feedType === 'following') { %>
                <p>Your desk is clear. Follow some master architects to start building your feed.</p>
                <a href="/explore" class="btn btn-outline" style="margin-top:1.25rem">Find Architects →</a>
              <% } else { %>
                <p>The workshop is currently empty. Engineer the first blueprint for the community.</p>
                <a href="/posts/create" class="btn btn-primary" style="margin-top:1.25rem">Construct Post →</a>
              <% } %>
            </div>
          <% } %>

          <div class="post-list">
            <% posts.forEach(post => { %>
              <%- include('../partials/post-card', { post }) %>
            <% }) %>
          </div>

          <% if (pages > 1) { %>
            <%- include('../partials/pagination', { page, pages, activeTag }) %>
          <% } %>
        </div>

        <!-- Sidebar -->
        <aside class="feed-sidebar">
          <% if (!currentUser) { %>
            <div class="widget" style="background:var(--grad-subtle);border-color:rgba(139,92,246,0.2)">
              <div style="margin-bottom:1rem">
                <img src="/img/brand/logo.svg" alt="" width="48" height="48" />
              </div>
              <h3 style="font-size:1.1rem;margin-bottom:0.4rem">Join ThinkNote</h3>
              <p style="font-size:0.9rem;margin-bottom:1.25rem">Write and discover ideas that matter. Free forever.</p>
              <a href="/auth/register" class="btn btn-primary btn-full">Get Started Free</a>
              <a href="/auth/login" class="btn btn-ghost btn-full" style="margin-top:0.5rem;font-size:0.88rem">Already have an account?</a>
            </div>
          <% } %>

          <div class="widget">
            <div class="widget-title">Explore Topics</div>
            <div class="tag-list">
              <a href="/?tag=technology" class="tag">#technology</a>
              <a href="/?tag=design" class="tag">#design</a>
              <a href="/?tag=programming" class="tag">#programming</a>
              <a href="/?tag=startup" class="tag">#startup</a>
              <a href="/?tag=ai" class="tag">#ai</a>
              <a href="/?tag=productivity" class="tag">#productivity</a>
            </div>
            <a href="/explore" class="btn btn-ghost btn-sm" style="margin-top:1rem;width:100%">Browse all tags →</a>
          </div>

          <div class="widget">
            <div class="widget-title">Quick Links</div>
            <a href="/explore" class="dropdown-item" style="border-radius:var(--radius-sm);padding:0.6rem 0.75rem">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
              Explore
            </a>
            <% if (currentUser) { %>
              <a href="/bookmarks" class="dropdown-item" style="border-radius:var(--radius-sm);padding:0.6rem 0.75rem">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m19 21-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"/></svg>
                Bookmarks
              </a>
              <a href="/new-post" class="dropdown-item" style="border-radius:var(--radius-sm);padding:0.6rem 0.75rem">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12h14"/></svg>
                Write a post
              </a>
            <% } %>
          </div>
        </aside>
      </div>
    </div>
  </main>

  <footer class="site-footer">
    <div class="container">
      <p>© 2026 <strong>ThinkNote</strong> · <a href="/explore">Explore</a> · <a href="/auth/register">Sign Up</a></p>
    </div>
  </footer>

  <script src="/js/main.js"></script>
</body>
</html>
